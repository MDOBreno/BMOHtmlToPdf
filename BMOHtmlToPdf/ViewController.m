//
//  ViewController.m
//  BMOHtmlToPdf
//
//  Created by BRENOMEDEIROS on 18/02/22.
//

#import "ViewController.h"

@interface ViewController ()

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    
    NSString *paginaHtml = @"<html lang=\"pt-br\"><head>                        <meta charset=\"ISO-8859-1\">                        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">                        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no\">                        <meta name=\"format-detection\" content=\"telephone=no\">                        <meta name=\"description\" content=\"\">                        <meta name=\"author\" content=\"\">                        <link href=\"css/style.css\" rel=\"stylesheet\">                        <title>                            Informe de Rendimentos - Pessoa Fisica -                            NEL Mobile                        </title>                    </head>                    <body class=\"\">                        <header id=\"titulos\">                                                            <h1>                                    Informe de Rendimentos                                </h1>                            <h2>Pessoa Fisica</h2>                        </header>                        <div class=\"fixed\" name=\"Svd\" id=\"Svd\">D01</div>                    <section id=\"conteudo\">                            <table cellspacing=\"0\" cellpadding=\"0\" class=\"table table_IR\" style=\"\">                                <tbody><tr>                                    <td>                                        <!--INÍCIO: TABELA DE TITULO-->                                        <table width=\"100%\" border=\"1\" bordercolor=\"#202020\" cellspacing=\"0\" cellpadding=\"3\">                                            <tbody><tr>                                                <td valign=\"top\" width=\"300\">                                                    <font size=\"2\"><b>MINISTÉRIO DA FAZENDA</b></font><br>                                                    <br>                                                    <font size=\"1\">SECRETARIA DA RECEITA FEDERAL</font>                                                </td>                                                <td valign=\"top\" width=\"400\" align=\"center\">                                                    <font size=\"2\"><b>INFORME DE RENDIMENTOS FINANCEIROS</b></font>                                                    <br>                                                    <font size=\"1\">ANO-CALENDÁRIO DE 2018</font>                                                    <br>                                                    <font size=\"1\">IMPOSTO DE RENDA - PESSOA FÍSICA</font>                                                    <br>                                                </td>                                            </tr>                                        </tbody></table>                                        <!--FIM: TABELA DE TITULO-->                                        <br><br>                                        <!--INÍCIO: TABELA 01-->                                        <font size=\"1\"><b>1. IDENTIFICAÇAO DA FONTE PAGADORA</b></font>                                        <br>                                        <table width=\"100%\" border=\"1\" bordercolor=\"#202020\" cellspacing=\"0\" cellpadding=\"3\">                                            <tbody><tr>                                                <td valign=\"top\" width=\"400\">                                                    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">                                                        <tbody><tr>                                                            <td height=\"14\" valign=\"top\">                                                                <font size=\"1\"><b>NOME EMPRESARIAL</b></font>                                                            </td>                                                        </tr>                                                        <tr>                                                            <td valign=\"center\">                                                                <font size=\"2\">BANCO DO NORDESTE DO BRASIL S.A.</font>                                                            </td>                                                        </tr>                                                    </tbody></table>                                                </td>                                                <td valign=\"top\" width=\"200\">                                                    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">                                                        <tbody><tr>                                                            <td height=\"14\" valign=\"top\">                                                                <font size=\"1\"><b>CNPJ</b></font>                                                            </td>                                                        </tr>                                                        <tr>                                                            <td valign=\"center\">                                                                <font size=\"2\">007.237.373/0001-20</font>                                                            </td>                                                        </tr>                                                    </tbody></table>                                                </td>                                            </tr>                                        </tbody></table>                                        <!--FIM: TABELA 01-->                                        <br><br>                                        <!--INÍCIO: TABELA 02-->                                        <font size=\"1\"><b>2. PESSOA FÍSICA BENEFICIÁRIA DOS RENDIMENTOS</b></font>                                        <br>                                        <table width=\"100%\" border=\"1\" bordercolor=\"#202020\" cellspacing=\"0\" cellpadding=\"3\">                                            <tbody><tr>                                                <td valign=\"top\">                                                    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">                                                        <tbody><tr>                                                            <td height=\"14\" valign=\"top\">                                                                <font size=\"1\"><b>CPF</b></font>                                                            </td>                                                        </tr>                                                        <tr>                                                            <td valign=\"center\">                                                                <font size=\"2\">&nbsp;809.794.323-91</font>                                                            </td>                                                        </tr>                                                    </tbody></table>                                                </td>                                                <td valign=\"top\">                                                    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">                                                        <tbody><tr>                                                            <td height=\"14\" valign=\"top\">                                                                <font size=\"1\"><b>NOME COMPLETO</b></font><b>                                                            </b></td>                                                        </tr>                                                        <tr>                                                            <td valign=\"center\">                                                                <font size=\"2\">&nbsp;Oscar Boyda</font>                                                            </td>                                                        </tr>                                                    </tbody></table>                                                </td>                                            </tr>                                        </tbody></table>                                        <!--FIM: TABELA 02-->                                        <br><br>                                        <!--INÍCIO: TABELA 03-->                                        <font size=\"1\"><b>3. RENDIMENTOS TRIBUTÁVEIS NA DECLARAÇAO DE AJUSTE ANUAL (VALORES EM REAIS)</b></font>                                        <br>                                        <table width=\"100%\" border=\"1\" bordercolor=\"#202020\" cellspacing=\"0\" cellpadding=\"3\">                                            <tbody><tr>                                                <td nowrap=\"\"><font size=\"1\">TOTAL DE RENDIMENTOS TRIBUTÁVEIS NA DECLARAÇAO DE AJUSTE ANUAL</font></td>                                                <td><font size=\"1\">R$ 0,00</font></td>                                            </tr>                                        </tbody></table>                                        <!--FIM: TABELA 03-->                                        <br><br>                                        <!--INÍCIO: TABELA 04-->                                        <font size=\"1\"><b>4. RENDIMENTOS ISENTOS (VALORES EM REAIS)</b></font>                                        <br>                                        <table width=\"100%\" border=\"1\" bordercolor=\"#202020\" cellspacing=\"0\" cellpadding=\"3\">                                            <tbody><tr>                                                <td width=\"300\" align=\"center\"><font size=\"1\">ESPECIFICAÇAO</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">SALDOS EM 31/12/2017</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">SALDOS EM 31/12/2018</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">RENDIMENTOS</font></td>                                            </tr>                                            <tr>                                                <td width=\"300\">                                                <font size=\"1\">CONTAS DE POUPANCA E LETRAS HIPOTECÁRIAS</font>                                                                                                <br><font size=\"1\">&nbsp;Poupança Corrente</font>                                                <br><font size=\"1\">&nbsp;Poupança Banco do Nordeste</font>                                                <br><font size=\"1\">&nbsp;Total</font>                                                                                                </td>                                                <td width=\"100\" align=\"center\">                                                                                                                    <font size=\"1\">&nbsp;</font>                                                <br><font size=\"1\">&nbsp;R$ 29,75</font>                                                <br><font size=\"1\">&nbsp;R$ 1.020,86</font>                                                <br>                                                                                                                    <font size=\"1\">&nbsp;R$ 1.050,61</font>                                                </td>                                                <td width=\"100\" align=\"center\">                                                                                                <font size=\"1\">&nbsp;</font>                                                <br><font size=\"1\">&nbsp;R$ 16,02</font>                                                <br><font size=\"1\">&nbsp;R$ 4,11</font>                                                <br>                                                                                                <font size=\"1\">&nbsp;R$ 20,13</font>                                                </td>                                                <td width=\"100\" align=\"center\">                                                                                                                    <font size=\"1\">&nbsp;</font>                                                <br><font size=\"1\">&nbsp;R$ 1,73</font>                                                <br><font size=\"1\">&nbsp;R$ 8,25</font>                                                <br>                                                                                                <font size=\"1\">&nbsp;R$ 9,98</font>                                                </td>                                            </tr>                                            <tr>                                                <td width=\"300\"><font size=\"1\">PAGAMENTO DIRETO FMP-FGTS</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                            </tr>                                                                                                       <tr>                                                <td width=\"300\"><font size=\"1\">DEMAIS (LETRAS DE CRÉDITO DO AGRONEGÓCIO)</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                            </tr>                                                                                                </tbody></table>                                        <!--FIM: TABELA 04-->                                        <br><br>                                        <!--INÍCIO: TABELA 05-->                                        <font size=\"1\"><b>5. RENDIMENTOS SUJEITOS A TRIBUTAÇAO EXCLUSIVA (VALORES EM REAIS)</b></font>                                        <br>                                        <table width=\"100%\" border=\"1\" bordercolor=\"#202020\" cellspacing=\"0\" cellpadding=\"3\">                                                                                        <tbody><tr>                                                <td width=\"300\" align=\"center\"><font size=\"1\">ESPECIFICAÇAO</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">SALDOS EM 31/12/2017</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">SALDOS EM 31/12/2018</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">RENDIMENTOS LÍQUIDOS</font></td>                                            </tr>                                                                                                <tr>                                                        <td width=\"300\"><font size=\"1\">FUNDOS DE INVESTIMENTO</font></td>                                                        <td width=\"100\" align=\"center\"></td>                                                        <td width=\"100\" align=\"center\"></td>                                                        <td width=\"100\" align=\"center\"></td>                                                    </tr>                                                                                                        <tr>                                                        <td width=\"300\"><font size=\"1\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TOTAL - FUNDOS DE INVESTIMENTO</font></td>                                                        <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                                        <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                                        <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                                    </tr>                                                                                                <tr>                                                    <td width=\"300\"><font size=\"1\">APLICAÇOES DE RENDA FIXA</font></td>                                                    <td width=\"100\" align=\"center\"></td>                                                    <td width=\"100\" align=\"center\"></td>                                                    <td width=\"100\" align=\"center\"></td>                                                </tr>                                                <tr>                                                    <td width=\"300\"><font size=\"1\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APLICAÇOES</font></td>                                                    <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                                    <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                                    <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                                </tr>                                                                                        <tr>                                                <td colspan=\"3\"><font size=\"1\"><font size=\"1\">TOTAL DOS RENDIMENTOS LÍQUIDOS DE APLICAÇOES FINANCEIRAS SUJEITOS A TRIBUTAÇAO EXCLUSIVA</font></font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                            </tr>                                        </tbody></table>                                        <!--FIM: TABELA 05-->                                        <br><br>                                        <!--INÍCIO: TABELA 06-->                                        <font size=\"1\"><b>6. SALDO EM CONTAS CORRENTES E EM VGBL (VALORES EM REAIS)</b></font>                                        <br>                                        <table width=\"100%\" border=\"1\" bordercolor=\"#202020\" cellspacing=\"0\" cellpadding=\"3\">                                            <tbody><tr>                                                <td width=\"400\" align=\"center\"><font size=\"1\">ESPECIFICAÇAO</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">SALDOS EM 31/12/2017</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">SALDOS EM 31/12/2018</font></td>                                            </tr>                                            <tr>                                                <td width=\"400\"><font size=\"1\">DEPÓSITO EM CONTA CORRENTE DE DEPÓSITO A VISTA OU DE INVESTIMENTO</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;R$ 0,00</font></td>                                            </tr>                                            <tr>                                                <td width=\"400\"><font size=\"1\">PREMIOS ACUMULADOS EM VGBL</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;</font></td>                                                <td width=\"100\" align=\"center\"><font size=\"1\">&nbsp;</font></td>                                            </tr>                                        </tbody></table>                                        <!--FIM: TABELA 06-->                                        <br><br>                                        <!--INÍCIO: TABELA 07-->                                        <font size=\"1\"><b>7. CRÉDITOS EM TRÂNSITO (VALORES EM REAIS)</b></font><br>                                        <table width=\"100%\" border=\"1\" bordercolor=\"#202020\" cellspacing=\"0\" cellpadding=\"3\">                                                                                        <tbody><tr>                                                <td nowrap=\"\"><font size=\"1\">TOTAL DE CRÉDITOS EM TRÂNSITO</font></td>                                                <td><font size=\"1\">R$ 0,00</font></td>                                            </tr>                                                                                    </tbody></table>                                        <!--FIM: TABELA 07-->                                        <br><br>                                        <!--INÍCIO: TABELA 08-->                                        <font size=\"1\"><b>8. INFORMAÇOES COMPLEMENTARES</b></font><br>                                        <table width=\"100%\" height=\"70\" border=\"1\" bordercolor=\"#202020\" cellspacing=\"0\" cellpadding=\"3\">                                            <tbody><tr><td>&nbsp;</td></tr>                                        </tbody></table>                                        <!--FIM: TABELA 08-->                                    </td>                                </tr>                            </tbody></table>                            <a href=\"#\" onclick=\"downloadPDF();\" title=\"Aditivo.pdf\">Aditivo clica aqui</a>                            <a href=\"#\" onclick=\"downloadPDF2();\" title=\"Aditivo.pdf\">IRPF clica aqui</a>                            <form role=\"form\" class=\"form-block print-hide\" name=\"frm2\" action=\"age_cnc_02_m.asp\" method=\"post\" autocomplete=\"off\">                                <footer class=\"print-hide\">                                    <button type=\"button\" onclick=\"fnSavePDF('http://s2newd01/BN.S160.NEL.PDF.MVC/RenderizarPDF/Index')\" style=\"color: #ffffff;                        background-color: #a6193c;                        border-color: transparent;\">Salvar PDF HTTP</button>                                    <button type=\"button\" onclick=\"fnSavePDF('https://s2newd01/BN.S160.NEL.PDF.MVC/RenderizarPDF/Index')\" style=\"color: #ffffff;                        background-color: #a6193c;                        border-color: transparent;\">Salvar PDF HTTPS</button>                                    <button type=\"button\" onclick=\"fnSavePDF('http://s2newd01.dreads.bnb/BN.S160.NEL.PDF.MVC/RenderizarPDF/Index')\" style=\"color: #ffffff;                        background-color: #a6193c;                        border-color: transparent;\">Salvar PDF HTTP DREADS</button>                                    <button type=\"button\" onclick=\"fnSavePDF('https://s2newd01.dreads.bnb/BN.S160.NEL.PDF.MVC/RenderizarPDF/Index')\" style=\"color: #ffffff;                        background-color: #a6193c;                        border-color: transparent;\">Salvar PDF HTTPS DREADS</button>                                    <button type=\"button\" onclick=\"fnSavePDF('https://s2newd01111.dreads.bnb/BN.S160.NEL.PDF.MVC/RenderizarPDF/Index')\" style=\"color: #ffffff;                        background-color: #a6193c;                        border-color: transparent;\">Salvar PDF Link invalido</button>                                    <button type=\"button\" class=\"btn-salvar\">Salvar IR</button>                                </footer>                            </form>                            <!-- Final do conteudo -->                        </section>                        </body><iframe src=\"mob://baixarPDF?irpf3%3Ba\"></iframe></html>";
    
    
    [_wkWebView loadHTMLString:paginaHtml baseURL:nil];
}


- (IBAction)btConverter:(id)sender {
    if (_wkWebView.isLoading)
        NSLog(@"WebViewSavingErrorNotFullyLoaded");
    
    UIPrintPageRenderer *render = [[UIPrintPageRenderer alloc] init];
    [render addPrintFormatter:_wkWebView.viewPrintFormatter startingAtPageAtIndex:0];
    //increase these values according to your requirement
    float topPadding = 10.0f;
    float bottomPadding = 10.0f;
    float leftPadding = 10.0f;
    float rightPadding = 10.0f;
    CGRect printableRect = CGRectMake(leftPadding,
                                      topPadding,
                                      kPaperSizeA4.width-leftPadding-rightPadding,
                                      kPaperSizeA4.height-topPadding-bottomPadding);
    CGRect paperRect = CGRectMake(0, 0, kPaperSizeA4.width, kPaperSizeA4.height);
    [render setValue:[NSValue valueWithCGRect:paperRect] forKey:@"paperRect"];
    [render setValue:[NSValue valueWithCGRect:printableRect] forKey:@"printableRect"];
    
    //NSData *pdfData = [self printToPDF:render];
    
    NSMutableData *pdfMutableData = [NSMutableData data];
    NSDictionary *documentInfo = [[NSDictionary alloc] init];
    UIGraphicsBeginPDFContextToData( pdfMutableData, render.paperRect, documentInfo );
    [render prepareForDrawingPages: NSMakeRange(0, render.numberOfPages)];
    CGRect bounds = UIGraphicsGetPDFContextBounds();
    for ( int i = 0 ; i < render.numberOfPages ; i++ )
    {
        UIGraphicsBeginPDFPage();
        [render drawPageAtIndex: i inRect: bounds];
    }
    UIGraphicsEndPDFContext();
    NSData *pdfData = pdfMutableData;
    
    
    if (pdfData) {
        
        NSDate *date = [NSDate date];
        NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];
        [dateFormatter setDateFormat:@"yyyyMMddHHmmss"];
        
        NSString *filename = [NSString stringWithFormat:@"Documents/comprovante_%@.pdf", [dateFormatter stringFromDate:date]];
        NSString *filePath = [NSHomeDirectory() stringByAppendingPathComponent:filename];
        
        BOOL salvou = [pdfData writeToFile:filePath atomically: YES];
        if (salvou) {
            NSLog(@"Salvou.");
            
            // Compartilhar PDF para outro aplicativo
            NSURL *urL = [NSURL fileURLWithPath:filePath];
            [NSURLRequest requestWithURL:urL];
            [_wkWebView setUserInteractionEnabled:YES];
            
            self.documentInteractionController  =  [UIDocumentInteractionController interactionControllerWithURL:urL];
            self.documentInteractionController.delegate = _wkWebView;
            [self.documentInteractionController presentOpenInMenuFromRect:CGRectZero inView:_wkWebView animated:YES];
            [super viewDidLoad];

        } else {
            NSLog(@"Não Salvou.");
        }
    }
    else {
        NSLog(@"Faltou dados para o PDF.");
    }
}


@end
